#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed May  4 21:49:08 2022

@author: luiza.maciel
"""
import numpy as np
from scipy.integrate import solve_ivp,odeint
from math import radians,degrees
import matplotlib.pyplot as plt
from math import exp
from scipy.optimize import curve_fit
from edos import *

def find_nearest(array, value):
    idx = (np.abs(array - value)).argmin()
    if array[idx]<=value:
        return idx
    else:
        return idx-1
c=8
h=18
o=0
n=0

Ae=(5.7*10**11) #octano
Ea=15098
me=0.25
ne=1.5

cilindros=4
rotacao=2500
Var=89.25
Ru=8.314


N=rotacao*2*np.pi/60 #rad/s
M_c=(12.0107*c+h*1.008+16*o+28*n)
#
##quantidades estequimetricas de produtos
stoichometricH2O = h/2
stoichometricCO2 = c
OC = (2*stoichometricCO2 + stoichometricH2O - o)/2 #mols de oxigenio
stoichometricN2 = 3.76*OC+n

AC = OC*(32 + 3.76 * 28.16) / M_c  #razao ar combustivel
M_m=(M_c+OC*(32+3.76*28.16))/(1+OC+OC*3.76)  #massa molecular da mistura

#massa de ar admitida
m_air=Var/(0.5*3600*cilindros*(N/(2*np.pi))) #rot por s
#massa de mistura admitida
m_m=m_air/AC+m_air 
#massa de combustivel admitida
m_c=m_air/AC
mols_c = m_c/M_c
#
##fracao massica inicial
Y0 = m_c/m_m
X0 = mols_c/(mols_c+mols_c*OC+3.76*OC*mols_c)
#Rg=Ru/M_m #constante dos gases
##print(X0)
#Y0=m_c/(m_c+32*OC*mols_c)
#X0 = mols_c/(OC*mols_c)
#M_m = (M_c+OC*32)/(1+OC)
teta0d=-164
teta_combd=-4
delta_tetad=37.6
tetafd=146

teta0=radians(teta0d)
tetaf=radians(tetafd)
teta_comb=radians(teta_combd)
delta_teta=radians(delta_tetad)

mass=[M_c,32,28,44,18,28]

def twoStepKinects (Concentrations0,ts,Temperature,Pressure):
    concentration = solve_ivp(dc,ts,Concentrations0,args=(Temperature,)).y
        
    C = concentration[0][-1]
    O2=concentration[1][-1]
    CO = concentration[2][-1]
    CO2=concentration[3][-1]
    H2O = concentration[4][-1]
    N2 = concentration[5][-1]
    next_concentration=[C,O2,CO,CO2,H2O,N2]
    
    molar_fractions = np.asarray(Concentrations0)*Ru*Temperature*10**6/Pressure
    #molar_fractions = np.asarray(next_concentration)*Ru*Temperature*10**6/Pressure
    M_m=0
    for M,ys in zip(mass,molar_fractions):
        M_m += M*ys
        
    mass_fraction=molar_fractions[0]*(M_c/M_m)
    mass_burned=(Y0-mass_fraction)/Y0
    dx = (-dc(ts[-1],Concentrations0,Temperature)[0]*Ru*Temperature/Pressure)*(M_c/M_m)*10**6/Y0

    return mass_burned,dx,next_concentration,molar_fractions*m_m/M_m

def dc (t,Concentrations,T):
    C=Concentrations[0]
    O2=Concentrations[1]
    CO=Concentrations[2]
    CO2=Concentrations[3]
    H2O=Concentrations[4]
    N2=Concentrations[5]
    
    ka=Ae*np.exp(-Ea/T)*np.sign(C)*abs(C)**me*O2**ne
    kbf=10**14.6*np.exp(-20131/T)*CO*H2O**0.5*O2**0.25
    kbr=5*10**8*np.exp(-20131/T)*CO2
    
    dC=-ka/N
    dO2=(-(c/2+h/4)*ka-c*0.5*kbf+c*0.5*kbr)/N
    dCO=(-kbf+ka+kbr)*c/N
    dCO2=(kbf-kbr)*c/N
    dH2O=h/2*ka/N
    dN2=0
    #print(dC,dO2,dCO,dCO2,dH2O)
    return dC,dO2,dCO,dCO2,dH2O,dN2 #gmol;cm3

tk=np.linspace(teta0,tetaf,400)
ti=tk[:find_nearest(tk,teta_comb)]
tj=tk[find_nearest(tk,teta_comb):find_nearest(tk,teta_comb+delta_teta)]
tf=tk[find_nearest(tk,teta_comb+delta_teta):]
time = np.linspace(0,10)

Pi=1425444.9612099533
Ti=723.7213524993258 

wiebeTemperature = [374.9079248949613, 381.26585302702836, 381.43153486106763, 381.6054338865101, 381.7875818062139, 381.9780123698148, 382.1767613804437, 382.3838667018863, 382.5993682661749, 382.8233080816135, 383.05573024123055, 383.29668093165577, 383.5462084424157, 383.80436317564624, 384.07119765622014, 384.34676654227684, 384.63112663616425, 384.9243368957792, 385.2264584463034, 385.5375545923388, 385.85769083042874, 386.1869348619715, 386.52535660651444, 386.87302821543454, 387.2300240859907, 387.59642087575946, 387.9722975174382, 388.35773523402213, 388.752817554349, 389.15763032900924, 389.572261746624, 389.9968023504803, 390.4313450555337, 390.87598516576554, 391.3308203919052, 391.7959508695028, 392.2714791773671, 392.757510356356, 393.25415192852375, 393.7615139166357, 394.27970886402176, 394.80885185480406, 395.3490605344794, 395.9004551308589, 396.4631584753722, 397.0372960247344, 397.62299588297424, 398.2203888238331, 398.82960831352926, 399.45079053388844, 400.08407440585404, 400.72960161336385, 401.3875166276028, 402.0579667316356, 402.74110204541273, 403.4370755511591, 404.1460431191404, 404.8681635338059, 405.6035985203177, 406.3525127714472, 407.11507397485644, 407.89145284074425, 408.6818231298671, 409.48636168191143, 410.3052484442276, 411.1386665009096, 411.9868021022011, 412.84984469422824, 413.7279869490332, 414.62142479488875, 415.53035744688094, 416.4549874377257, 417.3955206487886, 418.3521663412818, 419.3251371875863, 420.31464930267055, 421.32092227554006, 422.3441792006712, 423.38464670936526, 424.4425550009395, 425.51813787368974, 426.61163275553275, 427.7232807342176, 428.8533265870023, 430.00201880969587, 431.16960964487333, 432.3563551091821, 433.56251501953915, 434.7883530180296, 436.03413659533857, 437.3001371124553, 438.5866298204733, 439.89389387814447, 441.22221236696794, 442.5718723034627, 443.94316464829984, 445.3363843118797, 446.75183015602533, 448.1898049912555, 449.650615569205, 451.134572569667, 452.6419905816517, 454.17318807786495, 455.7284873819186, 457.30821462751203, 458.912699708843, 460.5422762213183, 462.1972813916407, 463.8780559962836, 465.5849442671957, 467.3182937835578, 469.07845534831444, 470.86578284801965, 472.68063309454425, 474.52336564688795, 476.3943426114521, 478.29392841869475, 480.22248957421715, 482.1803943818964, 484.16801263672136, 486.18571528464486, 488.23387404661645, 490.31286100370755, 492.42304814002637, 494.5648068398305, 496.7385073349513, 498.94451809839444, 501.18320517958415, 503.4549314764243, 505.7600559389687, 508.09893269904865, 510.47191011986166, 512.8793297589735, 515.321525237777, 517.7988210099321, 520.3115310206888, 522.8599572485108, 525.4443881197758, 528.0650967866359, 530.7223392575078, 533.4163523689384, 536.1473515868204, 538.9155286242575, 541.7210488624314, 544.564048560183, 547.4446318371012, 550.362867414071, 553.3187850945335, 556.3123719686314, 559.3435683220384, 562.4122632300797, 565.5182898174517, 568.6614201630514, 571.8413598291379, 575.057741993541, 578.3101211638829, 581.5979664525786, 584.9206543920334, 588.2774612704721, 591.6675549696625, 595.0899862882002, 598.5436797360278, 602.0274237892743, 605.5398605986026, 609.0794751492488, 612.6445838769981, 616.2333227523318, 619.8436348532687, 623.4732574588008, 627.1197087066032, 630.7802738737835, 634.4519913554832, 638.1316384358703, 641.8157169668438, 645.5004390943235, 649.1817131985612, 652.8551302441655, 656.5159507672303, 660.1590927610808, 663.7791207577772, 667.370236439375, 670.9262711506325, 674.4406807212869, 677.9065430410934, 681.3165588618826, 684.6630563269416, 687.9379997461433, 691.1330031431786, 694.2393490967257, 697.2480133767573, 700.1496958382432, 702.9348579742651, 705.5937674463667, 708.1165498003571, 710.4932474393421, 712.7138857627542, 714.7685461916024, 716.6474455897055, 718.341021362323, 719.8400212748818, 721.1355967933412, 722.2193985150662, 723.0836720459988, 723.7213524993258, 724.1261556550618, 716.2004488138253, 712.2263295610222, 712.2296705475451, 716.1920801513418, 724.0511443921107, 735.7027217625875, 751.0049957298365, 769.7837917003334, 791.8385726410303, 816.9485456288301, 844.8784164900491, 875.3834811979983, 908.2138998300377, 943.1181314049899, 979.8456007632742, 1018.1487202488815, 1057.7844063371485, 1098.5152250258932, 1140.1102800209196, 1182.3459325757424, 1225.0064166933175, 1267.8843912822058, 1310.7814530888381, 1353.5086209641543, 1395.8867928449952, 1437.7471710420875, 1478.9316482843958, 1519.293145773583, 1558.69589467285, 1597.0156535111512, 1634.1398555718056, 1669.967682172139, 1704.4100596502778, 1737.389579704481, 1768.8403444156024, 1798.7077387539077, 1826.9481346205632, 1853.5285314801554, 1878.426139424172, 1901.6279110726791, 1923.1300290959152, 1942.93735634009, 1961.062855599736, 1977.526986004999, 1992.357082821636, 2005.5867271970963, 2017.2551120583046, 2027.406409981189, 2036.0891484274277, 2043.355597285722, 2049.2611731780535, 2053.8638645001975, 2057.2236806678698, 2059.4021285428744, 2060.461718521507, 2060.4655022858965, 2059.4766437517205, 2057.558024297529, 2054.7718829346736, 2051.1794916760387, 2046.8408659891559, 2041.8145098770037, 2036.1571948199173, 2029.9237715354188, 2023.1670132714278, 2015.9374891410282, 2008.2834658347908, 2000.2508359091162, 1991.8830707437514, 1983.2211961886055, 1974.3037888771526, 1965.1669911683055, 1955.8445426880958, 1946.3678264768655, 1936.7659278000199, 1927.0657037524616, 1917.2918618721624, 1907.4670460769564, 1897.6119283464282, 1887.745304685984, 1877.88419402973, 1868.043938861542, 1858.2383064566634, 1848.4795897687068, 1838.7787071058856, 1829.1452998564644, 1819.587827633385, 1810.1136603134798, 1800.7291665434593, 1791.439798377341, 1782.2501717916432, 1773.1641429017552, 1764.1848797700397, 1755.3149297570253, 1746.5562824195745, 1737.910428006398, 1729.378411638869, 1720.9608832993085, 1712.6581437739246, 1704.470186719495, 1696.396737038358, 1688.4372857586147, 1680.5911216226928, 1672.8573595923485, 1665.234966479125, 1657.7227839064963, 1650.3195488074325, 1643.0239116543296, 1635.8344526113506, 1628.7496957913838, 1621.7681217896795, 1614.888178657411, 1608.1082914677145, 1601.4268706166424, 1594.842318991307, 1588.3530381270439, 1581.9574334656345, 1575.6539188173174, 1569.4409201196365, 1563.3168785780288, 1557.2802532643855, 1551.329523242501, 1545.4631892819582, 1539.6797752155312, 1533.9778289889518, 1528.3559234465793, 1522.812656890992, 1517.346653450746, 1511.956563285156, 1506.641062652433, 1501.3988538635622, 1496.228665141329, 1491.1292504014452, 1486.0993889703104, 1481.137885251667, 1476.243568353208, 1471.4152916817848, 1466.6519325150807, 1461.952391556204, 1457.3155924767018, 1452.7404814523293, 1448.2260266954574, 1443.7712179874015, 1439.3750662127634, 1435.0366028981452, 1430.7548797569036, 1426.528968240967, 1422.3579591010273, 1418.240961955589, 1414.1771048696687, 1410.1655339433473, 1406.2054129104727, 1402.2959227477356, 1398.436261294132, 1394.6256428805336, 1390.8632979697193, 1387.1484728063433, 1383.4804290768368, 1379.8584435790317, 1376.2818079012434, 1372.749828110502, 1369.261824449936, 1365.8171310446885, 1362.4150956163799, 1359.0550792057816, 1355.736455903401, 1352.4586125877358, 1349.2209486709648, 1346.022875851833, 1342.8638178754702, 1339.7432102998885, 1336.660500269041, 1333.6151462920539, 1330.6066180285459, 1327.6343960797983, 1324.6979717855763, 1321.7968470263957, 1318.9305340310962, 1316.0985551894953, 1313.300442869955, 1310.535739241813, 1307.803996102319, 1305.1047747081495, 1302.437645611187, 1299.8021884985476, 1297.1979920366334, 1294.624653719127, 1292.0817797188915, 1289.568984743468, 1287.085891894257, 1284.6321325291708, 1282.207346128714, 1279.811180165297, 1277.4432899758538, 1275.1033386375389]
wiebePressure = [67490.0, 71911.27198643053, 72037.1472964978, 72169.22932252969, 72307.5756306319, 72452.24677496245, 72603.30634710682, 72760.8210281027, 72924.86064317898, 73095.49821927944, 73272.8100454443, 73456.87573612714, 73647.7782975285, 73845.60419703268, 74050.44343583853, 74262.38962487761, 74481.54006412244, 74707.99582538797, 74941.86183873692, 75183.24698260595, 75432.2641777725, 75689.03048529151, 75953.66720853433, 76226.29999947138, 76507.05896934353, 76796.07880387883, 77093.49888321343, 77399.46340668737, 77714.1215226918, 78037.62746375287, 78370.14068704762, 78711.82602055345, 79062.85381504685, 79423.40010217203, 79793.64675881556, 80173.7816780292, 80563.99894676004, 80964.49903065407, 81375.48896621517, 81797.182560616, 82229.80059946305, 82673.57106284617, 83128.72935000628, 83595.51851297588, 84074.18949956476, 84565.00140607868, 85068.2217401775, 85584.12669430113, 86113.00143010824, 86655.14037439588, 87210.84752699298, 87780.43678113827, 88364.23225688306, 88962.56864808367, 89575.7915835732, 90204.25800313444, 90848.33654892235, 91508.40797301677, 92184.86556182161, 92878.11557805457, 93588.5777211164, 94316.68560665823, 95062.88726621187, 95827.64566778352, 96611.43925836173, 97414.7625293319, 98238.12660583678, 99082.05986117826, 99947.10855740287, 100833.837513271, 101742.83080087081, 102674.69247219342, 103630.04731705275, 104609.54165380144, 105613.84415435891, 106643.64670514913, 107699.66530561223, 108782.64100604282, 109893.34088658706, 111032.55907931588, 112201.11783538928, 113399.86863941763, 114629.69337322234, 115891.50553130668, 117186.25149045928, 118514.911836003, 119878.50274735234, 121278.0774456348, 122714.72770626405, 124189.58543949312, 125703.82434208943, 127258.6616234405, 128855.35980950127, 130495.22862818213, 132179.62697989517, 133909.9649971461, 135687.70619719743, 137514.36973202066, 139391.53273986597, 141320.83280297878, 143303.9705161401, 145342.71217085503, 147438.8925601881, 149594.4179093869, 151811.2689375745, 154091.50405595847, 156437.2627080922, 158850.7688578645, 161334.33463099707, 163890.3641158774, 166521.3573296323, 169229.91435536917, 172018.739656472, 174890.6465738275, 177848.56201168543, 180895.5313177826, 184034.72336302098, 187269.43582578222, 190603.1006854553, 194039.2899293258, 197581.72147628322, 201234.2653200479, 205000.94989366614, 208885.96865590764, 212893.68689884574, 217028.6487743083, 221295.58453504834, 225699.4179842709, 230245.2741246381, 234938.48699492417, 239784.607679068, 244789.4124684782, 249958.91115388772, 255299.3554179138, 260817.247293555, 266519.3476470635, 272412.6846359789, 278504.5620843529, 284802.56770725106, 291314.5811054241, 298048.7814383602, 305013.65466962114, 312218.0002623431, 319670.9371846579, 327381.90906467836, 335360.68831206486, 343617.3789980138, 352162.4182576117, 361006.5759473094, 370160.9522562318, 379636.97293197375, 389446.3817402759, 399601.22973247693, 410113.8608453482, 420996.8933042713, 432263.19624332, 443925.860893861, 455998.16562788317, 468493.5340734027, 481425.4854470162, 494807.5761751633, 508653.3318003778, 522976.16809464915, 537789.3002302606, 553105.6387916435, 568937.6713530461, 585297.3283005921, 602195.8315466428, 619643.5247771826, 637649.6838931858, 656222.3063647012, 675367.8783181541, 695091.1183355018, 715394.697166633, 736278.9328584732, 757741.4611965736, 779776.8818514007, 802376.381235144, 825527.3338180999, 849212.8845366514, 873411.5159554643, 898096.6050286493, 923235.9756342899, 948791.4545246469, 974718.4399183611, 1000965.4936290453, 1027473.9693280951, 1054177.6912144423, 1081002.6989291802, 1107867.0759072744, 1134680.879385632, 1161346.1908543366, 1187757.3057034279, 1213801.0800367272, 1239357.4509580056, 1264300.1439639053, 1288497.577315245, 1311813.9683667908, 1334110.640840119, 1355247.5250311182, 1375084.8351453836, 1393484.8996399653, 1410314.1119958945, 1425444.9612099533, 1438758.09398766, 1433942.5064727403, 1435343.2571725415, 1443128.012857019, 1457333.550440382, 1477862.15243341, 1504484.5330291125, 1536848.8177354087, 1574494.4747670707, 1616869.7167305266, 1663350.7941547765, 1713261.7488489863, 1765893.4964576052, 1820521.4642367342, 1876421.3418506086, 1932882.7636617718, 1989220.9171448736, 2044786.172891119, 2098971.8770412, 2151220.458105335, 2201027.994347533, 2247947.3769614706, 2291590.1946006506, 2331627.4590314873, 2367789.2898033867, 2399863.676710615, 2427694.4408633504, 2451178.5169131863, 2470262.6792476405, 2484939.8331007315, 2495244.9872286376, 2501251.018142947, 2503064.3271597144, 2500820.481185649, 2494679.9167119903, 2484823.7744821883, 2471449.9201979376, 2454769.194875378, 2435001.9273732407, 2412374.7314568604, 2387117.6006890316, 2359461.3065456664, 2329635.0984657756, 2297864.699041779, 2264370.583161704, 2229366.5265567433, 2193058.4067588695, 2155643.2378342007, 2117308.4193007494, 2078231.179257017, 2038578.1918283666, 1998505.3494902807, 1958157.671561254, 1917669.3310994338, 1877163.7835241158, 1836753.9814613138, 1796542.6615395462, 1756622.690102655, 1717077.4560345495, 1677981.300085342, 1639399.9712347523, 1601391.10171629, 1564004.6933477113, 1527283.6087658077, 1491264.0620444533, 1455976.1039851021, 1421444.0981084167, 1387687.1840476485, 1354719.7256516411, 1322551.7416500666, 1291189.3172204322, 1260634.9952288656, 1230888.1462978774, 1201945.3171878469, 1173800.5572700915, 1146445.7231187327, 1119870.7614624312, 1094063.9709163215, 1069012.243063813, 1044701.2835794078, 1021115.8141805095, 998239.7562705007, 976056.3971902612, 954548.540032483, 933698.6379953104, 913488.9142602496, 893901.4683768036, 874918.3701234605, 856521.7417943883, 838693.8298330986, 821417.0667022027, 804674.1238403182, 788447.9565173385, 772721.8413560428, 757479.4072438749, 742704.6603133949, 728382.0036249019, 714496.2521391324, 701032.6435244984, 687976.8452996333, 675314.9587707855, 663033.52018351, 651119.4994704227, 639560.2969402653, 628343.7382200274, 617458.0677301063, 606891.9409424613, 596634.4156448151, 586674.9424081977, 577003.3544319294, 567609.8569190124, 558485.0161151079, 549619.7481270118, 541005.3076203984, 532633.2764823568, 524495.552521462, 516584.3382665614, 508892.12991535495, 501411.70647493214, 494136.11912833847, 487058.68085449544, 480172.9563226009, 473472.7520769922, 466952.1070238707, 460605.2832274469, 454426.7570197036, 448411.2104252683, 442553.5229004032, 436848.763383411, 431292.18265179644, 425879.205980583, 420605.4260949611, 415466.5964096479, 410458.6245467793, 405577.5661236843, 400819.6188015339, 396181.11658584385, 391658.52436949295, 387248.43270909146, 382947.5528255443, 378752.7118197952, 374660.8480948419, 370669.00697540265, 366774.33651685296, 362974.08349514776, 359265.5895699042, 355646.28761301446, 352113.69819537335, 348665.4262247253, 345299.1577277811, 342012.6567701511, 338803.7625078237, 335670.3863642394, 332610.50932728424, 329622.17936075217, 326703.50892502686, 323852.6726021284, 321067.9048203089, 318347.4976737327, 315689.7988329431, 313093.2095420156, 310556.18269848503, 308077.2210123894, 305654.87524081283, 303287.7424946231, 300974.4646141779, 298713.72661093733, 296504.25517207937, 294344.8172253504, 292234.2185615159, 290171.30251189455, 288154.9486785787, 286184.0717150854, 284257.6201552322, 282374.5752881953, 280533.95007777284, 278734.78812397696, 276976.16266515927, 275257.17561897525, 273576.9566605513, 271934.66233630467, 270329.4752119622, 268760.6030533271, 267227.27803849673, 265728.75600021303, 264264.31569715025, 262833.25811295403, 261434.90578192825, 260068.60214032527, 258733.71090218826, 257429.61545881792, 256155.71830091943, 254911.44046256147, 253696.2209860858, 252509.5164071984, 251350.80025944803]
wiebeMassFraction = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0031938649729299495, 0.0007470372238279621, 3.5544117338304204e-06, 0.0009672222530459074, 0.003633108317256939, 0.007987584079884869, 0.014008440975840752, 0.02166507907046855, 0.030918766105570983, 0.04172296385204899, 0.05402371792182803, 0.06776010647103403, 0.08286474257447607, 0.0992643244775906, 0.11688022744390758, 0.13562913052011139, 0.15542367124145895, 0.1761731211005907, 0.19778407450383695, 0.220161143940389, 0.24320765418894275, 0.2668263285798552, 0.2909199606131134, 0.31539206459683633, 0.34014749940979216, 0.3650930599956018, 0.3901380317561849, 0.4151947036173921, 0.4401788361797633, 0.46501008203122074, 0.4896123559752368, 0.5139141536069418, 0.5378488173405435, 0.5613547496445263, 0.5843755738674346, 0.6068602436285182, 0.6287631022969513, 0.6500438945845772, 0.6706677327252875, 0.69060502010525, 0.7098313355395973, 0.7283272816613375, 0.7460783010966481, 0.76307446424794, 0.779310232593752, 0.7947842014450417, 0.809498826074008, 0.8234601350581945, 0.8366774345636373, 0.8491630071312617, 0.860931808335756, 0.8720011644612248, 0.8823904740886049, 0.8921209162216004, 0.901215167296177, 0.9096971291286814, 0.9175916695643175, 0.9249243772956068, 0.9317213320337957, 0.9380088909386604, 0.9438134919470866, 0.949161474390964, 0.9540789170626058, 0.9585914936728924, 0.9627243454549613, 0.9665019704953899, 0.9699481292258604, 0.9730857653813215, 0.9759369416253039, 0.9785227889587034, 0.980863468964085, 0.9829781478922233, 0.9848849815698811, 0.9866011100962344, 0.9881426612983115, 0.9895247619317049, 0.9907615556399392, 0.9918662267226085, 0.9928510288070911, 0.9937273175697391, 0.9945055867084532, 0.9951955064280843, 0.9958059637618819, 0.9963451041150699, 0.9968203734795388, 0.9972385608306891, 0.997605840277863, 0.9979278125979073, 0.9982095458366772, 0.9984556147153123, 0.9986701386265587, 0.9988568180510806, 0.999018969264457, 0.9991595572423606, 0.9992812267042785, 0.999386331265144, 0.9994769606895353, 0.9995549662648331, 0.9996219843281098, 0.9996794579967858, 0.999728657165467, 0.9997706968411244, 0.9998065538961544, 0.9998370823241092, 0.9998630270862772, 0.9998850366390407, 0.9999036742322986, 0.9999194280684022, 0.9999327204092368, 0.9999439157164544, 0.9999533279066045, 0.9999612267991593, 0.9999678438313272, 0.9999733771092048, 0.9999779958603384, 0.9999818443482328, 0.9999850453048291, 0.9999877029325492, 0.9999899055231879, 0.9999917277368056, 0.999993232579821, 0.9999944731177798, 0.999995493954769, 0.9999963325081853, 0.9999970201045363, 0.9999975829191683, 0.999998042780253, 0.9999984178550374, 0.9999987232342435, 0.9999989714285893, 0.9999991727896855, 0.9999993358660181, 0.9999994677033496, 0.9999995740976528, 0.9999996598076031, 0.9999997287327016, 0.9999997840622606, 0.9999998283997452, 0.9999998638663229, 0.9999998921869104, 0.9999999147615237, 0.9999999327243143, 0.9999999469923125, 0.9999999583055882, 0.9999999672602684, 0.9999999743356276, 0.9999999799162665, 0.999999984310232, 0.9999999877637916, 0.9999999904734539, 0.9999999925957282, 0.9999999942550335, 0.9999999955500931, 0.9999999965590955, 0.9999999973438501, 0.9999999979531276, 0.9999999984253383, 0.9999999987906777, 0.9999999990728391, 0.9999999992903791, 0.9999999994578044, 0.9999999995864349, 0.9999999996850875, 0.9999999997606165, 0.999999999818341, 0.9999999998623812, 0.9999999998959225, 0.9999999999214232, 0.999999999940777, 0.9999999999554401, 0.9999999999665299, 0.9999999999749027, 0.999999999981213, 0.9999999999859608, 0.9999999999895266, 0.9999999999922, 0.999999999994201, 0.999999999995696, 0.999999999996811, 0.9999999999976412, 0.9999999999982583, 0.999999999998716, 0.9999999999990552, 0.9999999999993059, 0.999999999999491, 0.9999999999996273, 0.9999999999997277, 0.9999999999998013, 0.9999999999998552, 0.9999999999998948, 0.9999999999999236, 0.9999999999999446, 0.9999999999999599, 0.999999999999971, 0.9999999999999791]

#para 23% etanol->mudar para octano puro
Qa=[0.0, -0.000865946097461529, -0.0018063879339403543, -0.0028248973128029917, -0.003925065016298133, -0.005110501998199676, -0.006384840588438721, -0.007751735710468409, -0.009214866112114426, -0.010777935610680533, -0.012444674353102302, -0.014218840091948912, -0.016104219478104424, -0.018104629370973523, -0.020223918167080746, -0.022465967147954617, -0.024834691848214643, -0.02733404344480372, -0.029968010168335682, -0.03274061873755771, -0.035655935817956425, -0.038718069505572376, -0.041931170837115526, -0.045299435327513585, -0.04882710453607151, -0.05251846766243298, -0.056377863173617385, -0.060409680463406196, -0.06461836154543775, -0.06900840278138531, -0.07358435664566934, -0.07835083352819397, -0.08331250357665854, -0.08847409858005559, -0.09384041389502605, -0.09941631041681154, -0.10520671659660777, -0.11121663050719896, -0.11745112195882976, -0.12391533466733978, -0.13061448847669085, -0.1375538816380802, -0.1447388931479419, -0.15217498514723005, -0.1598677053844755, -0.1678226897452208, -0.1760456648505356, -0.1845424507274559, -0.19331896355428774, -0.20238121848385954, -0.2117353325479377, -0.22138752764616096, -0.2313441336230006, -0.24161159143640967, -0.2521964564219734, -0.2631054016565712, -0.27434522142571777, -0.285922834798939, -0.2978452893177544, -0.310119764801024, -0.32275357727264403, -0.33575418301680793, -0.34912918276626637, -0.36288632602929555, -0.37703351556133324, -0.39157881198750033, -0.4065304385825416, -0.4218967862150051, -0.4376864184627757, -0.4539080769074495, -0.470570686615347, -0.48768336181333366, -0.5052554117679959, -0.5232963468771301, -0.5418158849828864, -0.560823957916371, -0.5803307182839538, -0.6003465465060032, -0.6208820581192626, -0.6419481113546179, -0.6635558150025275, -0.6857165365789692, -0.7084419108053532, -0.7317438484164497, -0.7556345453110563, -0.7801264920607694, -0.8052324837929852, -0.8309656304649057, -0.8573393675461812, -0.8843674671285584, -0.9120640494817496, -0.9404435950756145, -0.969520957089633, -0.999311374431584, -1.0298304852883027, -1.0610943412324185, -1.093119421909999, -1.1259226503350908, -1.1595214088182866, -1.1939335555575616, -1.2291774419208654, -1.2652719304510656, -1.302236413625194, -1.3400908334011445, -1.3788557015863203, -1.418552121063997, -1.4592018079145825, -1.500827114470244, -1.5434510533427563, -1.5870973224657996, -1.6317903311942676, -1.6775552275044945, -1.724417926340591, -1.7724051391533275, -1.821544404679247, -1.8718641210087155, -1.9233935789926775, -1.976162997038769, -2.030203557348107, -2.085547443644631, -2.142227880449178, -2.2002791739504683, -2.259736754524889, -2.3206372209562707, -2.3830183864057517, -2.4469193261801383, -2.5123804273449553, -2.579443440225436, -2.6481515318349818, -2.7185493412658666, -2.7906830370714566, -2.8646003766620614, -2.9403507677284244, -3.0179853316969534, -3.0975569692091587, -3.179120427604142, -3.262732370367063, -3.3484514484880488, -3.436338373654589, -3.526455993175777, -3.61886936650854, -3.713645843223413, -3.810855142210496, -3.910569431883959, -4.012863411095554, -4.117814390413375, -4.22550237336061, -4.336010137139944, -4.449423312291531, -4.565830460644897, -4.685323150827809, -4.807996030485671, -4.933946894244107, -5.063276746312062, -5.196089856474036, -5.332493808055294, -5.472599536262903, -5.616521355107359, -5.764376970893293, -5.916287480032838, -6.07237734868166, -6.23277437142487, -6.397609605949076, -6.567017280328491, -6.741134669228761, -6.920101934995358, -7.104061929247061, -7.293159950244165, -7.48754345095313, -7.687361692391143, -7.892765336517263, -8.103905972653507, -8.32093557118508, -8.544005858121686, -8.773267604024035, -9.008869820834937, -9.250958860331698, -9.499677408267123, -9.755163368825098, -10.017548634820622, -10.286957740162595, -10.5635063925094, -10.84729988582232, -11.13843139469403, -11.436980154928863, -11.743009537898779, -12.056565029700138, -12.377672130082063, -12.706334190474369, -13.042530215153231, -13.38621265455373, -13.737305224846182, -14.095700792972151, -14.461259371183191, -14.83380626950272, -15.21313045816359, -15.598983194667857, -15.99107697136251, -16.389084839024868, -16.79264015963193, -17.20133683702462, -17.61473006742506, -18.032337642677557, -18.453641827738938, -18.878091820557522, -21.809339965650896, -23.434810196213252, -23.754097190942552, -22.773507493073755, -20.5060335106565, -16.97126926703768, -12.195267360343724, -6.210337504318937, 0.9452119450847958, 9.227387006743982, 18.586872139243777, 28.96944092604538, 40.31640814444305, 52.56511731050688, 65.64945726711454, 79.50040101003756, 94.04655973314154, 109.21474502006188, 124.93053221274113, 141.1188182370998, 157.70436754686133, 174.61234033718674, 191.76879775623908, 209.10117947993191, 226.53874968829734, 244.01300816863682, 261.45806395152715, 278.81096954494683, 296.0120144573985, 313.00497728450557, 329.7373361700585, 346.1604379394755, 362.2296266407206, 377.90433261596615, 393.14812356873574, 407.928719388298, 422.2179727482516, 435.99181771197874, 449.2301887560385, 461.9169127654401, 474.0395766636312, 485.58937341620634, 496.56092919193804, 506.95211447889847, 516.7638419383119, 525.999853735674, 534.6665010191582, 542.7725181211084, 550.3287939416083, 557.3481428359668, 563.8450771730405, 569.8355835613763, 575.3369045580872, 580.3673274841595, 584.9459817725657, 589.0926460750927, 592.8275661530911, 596.1712843791554, 599.1444814836096, 601.7678309938914, 604.0618666385756, 606.0468628225732, 607.7427281274443, 609.1689116519011, 610.3443218832629, 611.2872576813722, 612.0153508625306, 612.5455197922971, 612.8939333322579, 613.0759844365925, 613.1062726587602, 612.9985948060523, 612.765942969138, 612.4205091539949, 611.9736957536363, 611.4361311156422, 610.8176894874852, 610.1275146538395, 609.374046617313, 608.565050715255, 607.7076486094193, 606.8083506313313, 605.8730890133413, 604.9072515827321, 603.9157155431949, 602.9028810138624, 601.8727040403842, 600.8287288348084, 599.7741190409505, 598.711687859224, 597.6439268993925, 596.5730336612536, 595.5009375718334, 594.429324533251, 593.3596599580511, 592.293210288588, 591.2310630140914, 590.1741452135012, 589.123240664197, 588.0790055665302, 587.0419829418017, 586.0126157672042, 584.9912589154432, 583.978189969485, 582.9736189843151, 581.9776972679089, 580.9905252530016, 580.0121595298261, 579.0426191079313, 578.0818909726214, 577.1299349985893, 576.1866882800566, 575.2520689332762, 574.3259794236815, 573.4083094663423, 572.4989385447758, 571.5977380896086, 570.70457335513, 569.8193050284492, 568.9417906027944, 568.0718855434898, 567.2094442723187, 566.3543209933492, 565.5063703808516, 564.665448147683, 563.8314115104454, 563.0041195658355, 562.1834335908915, 561.3692172782888, 560.5613369164457, 559.7596615229462, 558.9640629386738, 558.1744158890576, 557.3905980179533, 556.6124898989076, 555.8399750278749, 555.0729398008558, 554.3112734794114, 553.5548681465505, 552.8036186550994, 552.0574225703224, 551.3161801082724, 550.5797940711004, 549.8481697803393, 549.1212150089982, 548.398839913147, 547.6809569635408, 546.9674808777281, 546.2583285529903, 545.5534190003856, 544.8526732801068, 544.1560144383102, 543.4633674455266, 542.774659136734, 542.0898181531398, 541.4087748856973, 540.731461420364, 540.0578114850931, 539.3877603985387, 538.7212450204447, 538.0582037036835, 537.3985762479023, 536.7423038547337, 536.0893290845233, 535.4395958145269, 534.7930491985265, 534.149635627819, 533.5093026935251, 532.8719991501741, 532.2376748805139, 531.6062808615022, 530.9777691314342, 530.3520927581612, 529.7292058083609, 529.109063317816, 528.4916212626646, 527.876836531583, 527.264666898865, 526.6550709983641, 526.0480082982629, 525.4434390766404, 524.8413243978043, 524.2416260893605, 523.6443067199895, 523.0493295779052, 522.456658649968, 521.8662586014278, 521.2780947562742, 520.6921330781688, 520.1083401519401, 519.5266831656173, 518.9471298929856, 518.3696486766408, 517.7942084115267, 517.2207785289359]
Qp=[0.0, 0.0005672136009572653, 0.0011832235375155101, 0.0018503694188664883, 0.002571003285784706, 0.003347490391833707, 0.004182209992426944, 0.005077556142228073, 0.006035938501384747, 0.0070597831511005965, 0.008151533419062485, 0.009313650715250152, 0.010548615378670781, 0.0118589275355721, 0.013247107969703615, 0.014715699005210567, 0.01626726540276092, 0.01790439526952243, 0.019629700983626378, 0.021445820133771762, 0.023355416474644366, 0.025361180898847063, 0.027465832426058504, 0.02967211921016237, 0.03198281956511293, 0.03440074301032803, 0.03692873133643116, 0.03956965969218813, 0.04232643769351864, 0.045202010555492875, 0.04819936024825542, 0.05132150667785679, 0.05457150889300832, 0.05795246631881433, 0.061467520018576534, 0.06511985398481143, 0.06891269646066048, 0.07284932129292566, 0.07693304931801127, 0.08116724978210126, 0.08555534179696023, 0.0901007958328047, 0.0948071352497447, 0.09967793786936571, 0.10471683758808556, 0.10992752603398835, 0.1153137542689104, 0.12087933453763532, 0.12662814206612788, 0.1325641169108255, 0.13869126586109495, 0.14501366439704919, 0.151535458705023, 0.15826086775310724, 0.16519418542924005, 0.1723397827444787, 0.1797021101041817, 0.18728569964995967, 0.19509516767538457, 0.20313521711857377, 0.21141064013491903, 0.21992632075336727, 0.22868723761982446, 0.23769846683141574, 0.24696518486550123, 0.2564926716075315, 0.26628631348201276, 0.2763516066910499, 0.2866941605651354, 0.2973197010310793, 0.3082340742021916, 0.3194432500960691, 0.33095332648558584, 0.34277053288894904, 0.3549012347049461, 0.3673519374998049, 0.3801292914523698, 0.3932400959646285, 0.4066913044449288, 0.42049002927158, 0.43464354694488244, 0.4491593034360013, 0.4640449197414927, 0.47930819765269106, 0.49495712574959394, 0.5109998856293192, 0.5274448583796785, 0.5443006313088837, 0.561576004942907, 0.5792800003025427, 0.5974218664727545, 0.6160110884774693, 0.6350573954735516, 0.6545707692783224, 0.6745614532456045, 0.6950399615059423, 0.7160170885873272, 0.7375039194334573, 0.7595118398372962, 0.7820525473084378, 0.805138062393571, 0.8287807404701217, 0.8529932840339617, 0.8777887555029256, 0.9031805905587166, 0.9291826120506435, 0.9558090444855247, 0.983074529128971, 1.010994139744154, 1.039583398995055, 1.0688582955420858, 1.0988353018588293, 1.1295313927995037, 1.1609640649475848, 1.1931513567767904, 1.2261118696563535, 1.2598647897331838, 1.294429910724074, 1.3298276576515884, 1.3660791115576083, 1.4032060352287086, 1.4412308999675456, 1.4801769134442397, 1.5200680486613016, 1.5609290740648918, 1.60278558483414, 1.6456640353787788, 1.689591773073418, 1.7345970732543412, 1.7807091755016464, 1.827958321225832, 1.876375792573389, 1.9259939526605256, 1.976846287137729, 2.028967447080222, 2.082393293190472, 2.137160941288454, 2.1933088090532915, 2.250876663965872, 2.309905672385866, 2.3704384496780686, 2.432519111281698, 2.4961933245920163, 2.5615083614960312, 2.6285131513726228, 2.697258334331895, 2.767796314428334, 2.840181312537069, 2.9144694185315574, 2.9907186423438077, 3.068988963424314, 3.1493423780473684, 3.2318429438280023, 3.3165568207284086, 3.4035523077340684, 3.492899874272008, 3.5846721853250267, 3.6789441190659367, 3.7757927756942795, 3.8752974760040266, 3.97753974804474, 4.082603300059941, 4.190573977695885, 4.301539703271921, 4.415590394691311, 4.532817861350659, 4.653315674179285, 4.777179006710141, 4.904504443855754, 5.035389754841355, 5.169933626539686, 5.308235353266483, 5.450394478942185, 5.596510387415946, 5.746681836696958, 5.901006432861306, 6.059580039518575, 6.222496118952261, 6.389845001413815, 6.561713079576824, 6.738181925870691, 6.91932733133803, 7.105218265822474, 7.295915760716604, 7.491471717202304, 7.6919276449118525, 7.897313338231522, 8.107645500053742, 8.322926325638225, 8.543142062327439, 8.768261564118157, 8.998234863436359, 9.232991785789615, 9.47244063614619, 9.716466988757235, 9.964932614517629, 10.217674581660164, 10.474504566394652, 10.735208409841611, 10.999545956090778, 11.267251203291229, 11.538032795256584, 11.811574875116298, 12.087538315112834, 12.3655623278761, 12.63598672276076, 12.901437964812319, 13.165740809781258, 13.432743745146187, 13.706304368495049, 13.990273857625436, 14.288479704951618, 14.604706050291623, 14.942671199110109, 15.30600220902655, 15.698206722579249, 16.122642490160512, 16.582485249358008, 17.08069580023075, 17.61998723824592, 18.202793376001257, 18.831239399879678, 19.507115768177954, 20.231856265435034, 21.006520989412216, 21.831784871430536, 22.707932128966423, 23.634856834287792, 24.612069567336693, 25.63870991692566, 26.713564411678846, 27.835089308723646, 29.001437548975968, 30.21048910538343, 31.45988390468781, 32.74705649206574, 34.06927162774922, 35.42366005062848, 36.80725371050228, 38.21701985247321, 39.64989342855646, 41.1028074078893, 42.57272065364426, 44.05664312824698, 45.551658275944206, 47.0549425111088, 48.563781810553195, 50.07558546783379, 51.58789711689002, 53.098403171608766, 54.604938857605966, 56.10549203347845, 57.59820501193187, 59.08137459756826, 60.553450558752274, 62.01303274688252, 63.45886706853725, 64.88984050521368, 66.30497536252452, 67.70342291644381, 69.08445660909052, 70.44746493109255, 71.79194411219147, 73.11749072674142, 74.42379430637074, 75.71063003849379, 76.97785161670542, 78.2253842974378, 79.45321820665575, 80.6614019308107, 81.85003641775853, 83.01926920583213, 84.16928899269796, 85.30032054996148, 86.41261998465133, 87.50647034463807, 88.58217756166476, 89.64006672291012, 90.68047865980485, 91.70376684111622, 92.71029455604193, 93.70043237215478, 94.67455585246694, 95.63304351558422, 96.57627502285573, 97.5046295765551, 98.41848451341966, 99.31821407829219, 100.20418836313362, 101.07677239727394, 101.93632537542872, 102.78320001070894, 103.61774200057631, 104.44028959443669, 105.25117325230451, 106.05071538470634, 106.83923016471296, 107.61702340369084, 108.38439248304164, 109.14162633484804, 109.88900546496306, 110.62680201266882, 111.35527984158337, 112.0746946570141, 112.78529414544371, 113.48731813228548, 114.18099875446406, 114.86656064476554, 115.54422112525567, 116.21419040739055, 116.87667179674276, 117.53186190053528, 118.17995083642008, 118.82112244116074, 119.45555447807546, 120.08341884227588, 120.70488176289481, 121.32010400163799, 121.92924104711874, 122.53244330454415, 123.12985628041844, 123.72162076201208, 124.30787299141802, 124.88874483407999, 125.46436394173047, 126.03485390972187, 126.60033442877354, 127.16092143118873, 127.71672723162227, 128.267860662502, 128.81442720422368, 129.356529110253, 129.89426552727906, 130.4277326105708, 130.95702363469323, 131.48222909974382, 132.003436833271, 132.5207320880357, 133.0341976357776, 133.54391385714408, 134.0499588279376, 134.55240840183401, 135.05133628972013, 135.54681413579377, 136.03891159056673, 136.52769638090422, 137.01323437723076, 137.49558965802726, 137.97482457173894, 138.4509997962086, 138.92417439574567, 139.39440587593566, 139.8617502362913, 140.32626202084043, 140.78799436674328, 141.24699905102628, 141.70332653551557, 142.1570260100502, 142.6081454340509, 143.056731576516, 143.50283005451445, 143.94648537024074, 144.38774094669438, 144.82663916204376, 145.26322138273102, 145.69752799537176, 146.1295984375014, 146.55947122721722, 146.98718399176266, 147.41277349509866, 147.83627566450468, 148.25772561624933, 148.67715768037013, 149.09460542459863, 149.51010167746617, 149.92367855062403, 150.33536746041005, 150.74519914869182, 151.15320370301623, 151.5594105760931, 151.96384860463905, 152.36654602760797, 152.76753050383164, 153.16682912909397, 153.56446845266146, 153.96047449329072, 154.35487275473363, 154.7476882407594, 155.1389454697125, 155.52866848862425, 155.91688088689477, 156.30360580956219, 156.68886597017462, 157.07268366327975, 157.45508077654685, 157.83607880253476, 158.21569885011908, 158.59396165559158, 158.97088759344402, 159.34649668684756]
W=[0.0, -0.04091272889163951, -0.08384766387366802, -0.1288163973261104, -0.17583107267071632, -0.22490438800155751, -0.27604959988777783, -0.32928052734908997, -0.384611556004631, -0.44205764239588685, -0.5016343184844684, -0.5633576963255307, -0.6272444729177507, -0.6933119352308502, -0.7615779654116583, -0.8320610461698926, -0.9047802663448118, -0.9797553266540454, -1.0570065456259985, -1.136554865717258, -1.2184218596165826, -1.3026297367371709, -1.3892013498989262, -1.478160202202623, -1.5695304540979982, -1.6633369306478047, -1.7596051289901524, -1.8583612260014253, -1.9596320861622973, -2.063445269629511, -2.1698290405161376, -2.2788123753832656, -2.390424971946228, -2.504697257998532, -2.6216604005569204, -2.7413463152311444, -2.8637876758221217, -2.989017924152401, -3.1170712801330547, -3.2479827520711844, -3.3817881472225126, -3.5185240825937347, -3.6582279959993658, -3.8009381573781242, -3.946693680374096, -4.095534534187976, -4.247501555704005, -4.402636461898407, -4.560981862535185, -4.722581273155447, -4.887479128366608, -5.05572079543784, -5.227352588208445, -5.402421781315993, -5.580976624750976, -5.763066358745216, -5.948741229000999, -6.138052502268238, -6.331052482277023, -6.5277945260327455, -6.728333060481333, -6.93272359955179, -7.141022761583381, -7.353288287144736, -7.569579057251811, -7.789955111991692, -8.014477669558882, -8.243209145710457, -8.476213173646059, -8.713554624318407, -8.955299627179388, -9.201515591366222, -9.452271227331616, -9.707636568920943, -9.967682995898576, -10.232483256924734, -10.50211149298265, -10.776643261255057, -11.05615555944716, -11.340726850551938, -11.630437088051659, -11.925367741547616, -12.225601822807768, -12.531223912219694, -12.842320185633412, -13.158978441575675, -13.481288128814187, -13.809340374246418, -14.14322801108376, -14.483045607297539, -14.828889494288404, -15.180857795735594, -15.53905045657661, -15.903569272061796, -16.274517916821296, -16.652001973874334, -17.03612896350275, -17.427008371901593, -17.824751679509912, -18.2294723889142, -18.641286052205402, -19.06031029765771, -19.48666485558351, -19.920471583204048, -20.36185448835889, -20.810939751859372, -21.26785574827221, -21.73273306489804, -22.20570451868695, -22.686905170808068, -23.176472338563272, -23.674545604305635, -24.18126682099105, -24.69678011395708, -25.221231878485067, -25.754770772660507, -26.29754770500247, -26.84971581628427, -27.41143045491542, -27.98284914519779, -28.564131547707706, -29.155439410988556, -29.756936513666236, -30.36878859602169, -30.991163279969733, -31.624229976301706, -32.26815977795064, -32.923125337930244, -33.58930073048366, -34.26686129385306, -34.95598345294722, -35.656844520039094, -36.36962247147011, -37.09449569817111, -37.83164272763013, -38.58124191474583, -39.34347109879953, -40.11850722356059, -40.906525917305686, -41.70770102928502, -42.522204118905776, -43.35020389362514, -44.19186559125257, -45.04735030205454, -45.916814225733724, -46.80040785802187, -47.69827510128064, -48.61055229315226, -49.53736714694176, -50.47883759705109, -51.435070542425734, -52.40616048062196, -53.392188024766845, -54.39321829536791, -55.40929917865059, -56.44045944286751, -57.48670670384986, -58.54802523097728, -59.62437358474631, -60.71568207724267, -61.8218500471003, -62.9427429409852, -64.07818919431772, -65.22797690487879, -66.39185029418026, -67.56950595306915, -68.76058887003538, -69.96468824316001, -71.18133307964743, -72.40998759049236, -73.6500463921157, -74.9008295318328, -76.161577359864, -77.43144527732109, -78.70949839726656, -79.99470616458046, -81.28593699000415, -82.58195296435706, -83.88140473049171, -85.1828266029782, -86.48463203864105, -87.78510957469152, -89.0824193650108, -90.37459045875464, -91.65951897837253, -92.93496736577109, -94.19856487498562, -95.4478094965365, -96.680071501726, -97.89259879348066, -99.08252424293022, -100.24687517671248, -101.38258515803494, -102.48650817398926, -103.55543530191414, -104.58611387846197, -105.57526913661052, -106.5196282088478, -107.41594632042529, -108.26103491685895, -109.05179138735821, -109.78522996381622, -110.45851329717617, -111.06898414354974, -111.61419653571411, -112.0891890488014, -112.4915836340595, -112.82306846634066, -113.08434965457505, -113.275107069393, -113.39398758192813, -113.43863607717789, -113.40576201781855, -113.29123718921836, -113.09021878795295, -112.79729128726949, -112.40662043868949, -111.91211317708083, -111.30757789431422, -110.5868803697002, -109.7440914803545, -108.77362359908005, -107.6703532975039, -106.42972860720195, -105.0478596602266, -103.5215920427837, -101.8485626586974, -100.0272383155415, -98.05693761529714, -95.93783705055907, -93.67096247362979, -91.25816731698362, -88.702099098716, -86.00615584669967, -83.17443412308685, -80.21167033101167, -77.12317694358364, -73.9147752181322, -70.5927258531635, -67.16365891864558, -63.63450424877781, -60.01242333649984, -56.30474361609051, -52.51889586892633, -48.66235534158528, -44.74258702789619, -40.766995439392595, -36.74287907335153, -32.677389684969526, -28.57749638054612, -24.44995447167817, -20.30127896593668, -16.13772251663835, -11.965257612245395, -7.789562753685288, -3.616012344466008, 0.5503299971629243, 4.704715003573897, 8.842708503192696, 12.960189646575948, 17.05334690762495, 21.11867214497297, 25.15295299645464, 29.153263865359495, 33.1169557414208, 37.041645082677555, 40.925201966865785, 44.765737703193146, 48.56159207754226, 52.31132038655559, 56.01368039891072, 59.667619365550934, 63.27226118482884, 66.82689381356208, 70.33095700095738, 73.78403040928553, 77.18582217312627, 80.5361579379533, 83.83497040879425, 87.08228943067222, 90.27823261448071, 93.42299651482486, 96.51684836014732, 99.56011833008864, 102.553192370456, 105.4965055323456, 108.39053581881367, 111.23579851996362, 114.03284101536165, 116.78223802123833, 119.48458725893833, 122.14050552048208, 124.75062510684907, 127.31559061464465, 129.8360560471148, 132.3126822259884, 134.74613448131979, 137.13708059733415, 139.48618899321943, 141.7941271188274, 144.0615600463216, 146.2891492399244, 148.47755148703587, 150.6274179751239, 152.73939349989857, 154.81411579136665, 156.8522149454141, 158.85431294957877, 160.8210232926372, 162.75295064854296, 164.6506906261204, 166.51482957672005, 168.3459444527969, 170.14460271107347, 171.91136225459132, 173.64677140855247, 175.35136892539245, 177.0256840150282, 178.67023639667227, 180.28553636901543, 181.87208489595244, 183.43037370535671, 184.96088539870954, 186.46409356966058, 187.94046292983387, 189.39044944040685, 190.8145004481829, 192.21305482504397, 193.58654310981862, 194.93538765173543, 196.26000275474473, 197.56079482209444, 198.83816250063708, 200.09249682442166, 201.32418135719266, 202.53359233348056, 203.72109879801855, 204.88706274326557, 206.0318392448577, 207.15577659484197, 208.2592164325765, 209.3424938732091, 210.40593763366593, 211.44987015610207, 212.47460772878318, 213.4804606043809, 214.46773311567563, 215.43672378867356, 216.3877254531513, 217.321025350649, 218.23690523994114, 219.13564150001713, 220.01750523061014, 220.88276235031424, 221.73167369233528, 222.56449509792154, 223.38147750752177, 224.1828670497217, 224.9689051280091, 225.73982850541847, 226.49586938710783, 227.23725550091947, 227.96421017597572, 228.67695241936204, 229.37569699094823, 230.06065447639747, 230.73203135841376, 231.390030086276, 232.0348491437062, 232.66668311511933, 233.28572275030015, 233.89215502755104, 234.48616321535508, 235.06792693259607, 235.63762220737624, 236.19542153447165, 236.74149393146368, 237.27600499358317, 237.7991169473039, 238.31098870271958, 238.81177590473752, 239.30163098312147, 239.7807032014147, 240.2491387047723, 240.70708056673206, 241.15466883495097, 241.59204057593368, 242.01932991877797, 242.43666809796167, 242.84418349519407, 243.24200168035364, 243.6302454515335, 244.00903487421513, 244.37848731958866, 244.73871750203935, 245.08983751581732, 245.43195687090707, 245.7651825281135, 246.08961893337943, 246.40536805134877]

c0fuel=Pi*X0/(Ru*Ti) #[Pa][gmol/gmol]/[J/molK][K] = [gmol/m3]
c0O2=Pi*X0*OC/(Ru*Ti)
c0N2=c0O2*3.76
lista1,lista2,lista3,lista4,lista5=[c0fuel*10**-6],[c0O2*10**-6],[0],[0],[0]
massFraction=[]

#next_concentration=[1,12.5,0,0,0,0]
next_concentration=[c0fuel*10**-6,c0O2*10**-6,0,0,0,c0N2*10**-6]

V0=volume(teta_comb)
P0=Pi
T0=Ti
Qa0=Qa[205]
Qp0=Qp[205]
W0=W[205]

P1=[67490.0, 67605.31715299033, 67726.48585637011, 67853.56102918337, 67986.60041897571, 68125.6646494179, 68270.81727046469, 68422.12481111193, 68579.6568348209, 68743.48599768164, 68913.68810939085, 69090.34219712409, 69273.53057238746, 69463.33890093573, 69659.85627585069, 69863.17529387769, 70073.39213512224, 70290.60664621576, 70514.92242706212, 70746.4469212849, 70985.29151049892, 71231.57161253723, 71485.40678377144, 71746.92082566574, 72016.24189571921, 72293.50262295085, 72578.84022809402, 72872.39664867263, 73174.31866914198, 73484.75805628161, 73803.87170004111, 74131.82176004742, 74468.77581799039, 74814.90703611716, 75170.39432207325, 75535.42250034315, 75910.18249055183, 76294.87149290284, 76689.6931810428, 77094.85790265322, 77510.58288808653, 77937.09246737871, 78374.6182959862, 78823.39958961091, 79283.6833684966, 79755.72471159496, 80239.78702102193, 80736.14229724399, 81245.07142545634, 81766.86447363265, 82301.82100275825, 82850.25038977314, 83412.4721637846, 83988.81635613416, 84579.62386492743, 85185.24683467475, 85806.04905171279, 86442.4063561144, 87094.70707083259, 87763.3524488488, 88448.75713915062, 89151.3496723884, 89871.57296711371, 90609.88485754082, 91366.75864382552, 92142.68366589013, 92938.16590189576, 93753.7285925008, 94589.91289210733, 95447.27854835446, 96326.40461118604, 97227.89017287703, 98152.35514047841, 99100.4410422112, 100072.81186941487, 101070.1549557333, 102093.18189531191, 103142.62950185996, 104219.2608105253, 105323.86612462778, 106457.26410939508, 107620.30293495259, 108813.86147092191, 110038.85053511392, 111296.21419890295, 112586.93115200622, 113912.01612952027, 115272.521404205, 116669.53834714548, 118104.19906007028, 119577.67808276044, 121091.19417913769, 122646.01220579576, 124243.44506689599, 125884.85575954305, 127571.6595139196, 129305.32603265614, 131087.38183410483, 132919.41270438745, 134803.06626326364, 136740.0546491021, 138732.15732842562, 140781.22403569252, 142889.17784922346, 145058.01840934707, 147289.8252850601, 149586.76149568736, 151951.07719421564, 154385.11351916008, 156891.3066219605, 159472.19187707122, 162130.40828203037, 164868.70305485424, 167689.9364362003, 170597.08670374018, 173593.2554061407, 176681.6728239705, 179865.70366469643, 183148.8529986668, 186534.77244264554, 190027.2665970407, 193630.29974233097, 197348.00279951925, 201184.68055850305, 205144.81917717127, 209233.09395267774, 213454.37736476274, 217813.74738909665, 222316.49607637062, 226968.1383902165, 231774.42129396464, 236741.33307268203, 241875.11287268566, 247182.2604360012, 252669.54600162958, 258344.0203390554, 264213.0248721604, 270284.201843288, 276565.5044575945, 283065.20693694596, 289791.91440022347, 296754.57247281185, 303962.4765121546, 311425.2803183344, 319153.0041783638, 327156.04207017913, 335445.1678268577, 344031.54003307, 352926.70539406576, 362142.6002820475, 371691.5501258578, 381586.2662663419, 391839.83985235554, 402465.7323000615, 413477.76178121276, 424890.08514407225, 436717.1746039776, 448973.7884686982, 461674.9350873879, 474835.8291313607, 488471.8392307207, 502598.4259041989, 517231.06863127527, 532385.1808282672, 548076.0114051924, 564318.5315011712, 581127.304926523, 598516.3407841775, 616498.9267066331, 635087.4411349648, 654293.1430899462, 674125.9379523958, 694594.117890042, 715704.075753293, 737459.9915263838, 759863.4907753606, 782913.2749978716, 806604.72436462, 830929.4740652175, 855874.9663446342, 881423.9813524762, 907554.1511333627, 934237.4624641697, 961439.7557877518, 989120.2291866533, 1017230.9581556446, 1045716.4438270034, 1074513.2042140514, 1103549.4248887552, 1132744.6871969302, 1162009.7935193554, 1191246.7100700503, 1220348.6481310008, 1249200.304294429, 1277678.2790600823, 1305651.6908694447, 1332982.9992349285, 1359529.045967323, 1385142.3176104282, 1409672.4251286574, 1432967.788824495, 1454877.5076537617, 1475253.3829251875, 1493952.0572762473, 1510837.2213437255, 1525781.8332674159, 1538670.2906547622, 1549400.4914141926, 1557885.719363103, 1564056.2930034432, 1567860.9214224536, 1569267.7197886775, 1568264.848026591, 1564860.7494173537, 1559083.9803707346, 1550982.6376181007, 1540623.4037188736, 1528090.2452142932, 1513482.8092632156, 1496914.5735736734, 1478510.8105175223, 1458406.4293190476, 1436743.7601927023, 1413670.341515817, 1389336.7659603208, 1363894.6344856734, 1337494.6587809757, 1310284.9437150783, 1282409.4721522033, 1254006.805591039, 1225209.005870474, 1196140.7759398315, 1166918.8115930234, 1137651.3512026863, 1108437.9068628314, 1079369.157896541, 1050526.9862960519, 1021984.6331951763, 993806.9557698854, 966050.7648604809, 938765.2249527925, 911992.2998052208, 885767.2288387544, 860119.021315017, 835070.9572293785, 810641.0856787836, 786842.7131804255, 763684.875987875, 741172.7918571279, 719308.2879502263, 698090.2026278334, 677514.7597825549, 657575.9151118849, 638265.6743365696, 619574.3838530661, 601490.9946809914, 584003.3008446615, 567098.1535252635, 550761.6524503757, 534979.3160629096, 519736.23204150907, 505017.1897398147, 490806.7960797092, 477089.576380737, 463850.06154033134, 451072.86290196626, 438742.73606386443, 426844.63479403174, 415363.7561290301, 404285.5776467841, 393595.8878191675, 383280.8102687366, 373326.82267696655, 363720.7710187673, 354449.87973035336, 345501.7583549003, 336864.4051525772, 328526.2081083769, 320475.94372304255, 312702.7739282149, 305196.2414271537, 297946.2637264395, 290943.1260917338, 284177.47363164905, 277640.3026877735, 271322.9516858423, 265217.0915822782, 259314.7160221407, 253608.13130816273, 248089.94626633046, 242753.0620806668, 237590.66215882968, 232596.20208029347, 227763.3996703148, 223086.22523536516, 218558.89198918984, 214175.84669293763, 209931.7605278792, 205821.52021496213, 201840.2193917366, 197983.15025407632, 194245.7954673611, 190623.8203495113, 187113.06532630528, 183709.5386577527, 180409.409432947, 177209.0008296625, 174104.78363401387, 171093.37001478625, 168171.50754636744, 165336.07347381004, 162584.06921314588, 159912.6150798495, 157318.94523814303, 154800.40286375786, 152354.43551270594, 149978.5906886303, 147670.51160136136, 145427.9331093718, 143248.67783896657, 141130.6524731597, 139071.8442033617, 137070.31733718296, 135124.21005581706, 133231.73131469046, 131391.15788125928, 129600.8315040187, 127859.15620702828, 126164.59570442988, 124515.67092967345, 122910.95767434167, 121349.08433167692, 119828.72974012222, 118348.62112235455, 116907.53211550397, 115504.28088841125, 114137.72834198063, 112806.776388825, 111510.3663085993, 110247.47717554918, 109017.12435498138, 107818.35806549518, 106650.26200395807, 105511.95203036671, 104402.57490982742, 103321.3071090587, 102267.35364491477, 101239.9469825451, 100238.34598093251, 99261.83488363662, 98309.72235268813, 97381.34054367163, 96476.04422011955, 95593.2099054373, 94732.23507066022, 93892.5373564237, 93073.55382759988, 92274.74025913855, 91495.5704517053, 90735.5355757866, 89994.14354299044, 89270.91840333039, 88565.39976734234, 87877.14225193011, 87205.71494889868, 86550.70091517155, 85911.69668374528, 85288.31179447226, 84680.16834381095, 84086.90055271915, 83508.15435190448, 82943.58698368756, 82392.8666197622, 81855.67199417672, 81331.69205088429, 80820.6256052484, 80322.18101891209, 79836.0758874726, 79362.03674042289, 78899.79875284938, 78449.1054684029, 78009.70853307204, 77581.36743932127, 77163.84928016743, 76756.92851279407, 76360.38673131423, 75974.01244832101, 75597.60088486847, 75230.95376855339, 74873.87913937678, 74526.19116307973, 74187.70995166474, 73858.26139082246, 73537.67697400278, 73225.79364287105, 72922.45363391537, 72627.50433096812, 72340.79812342604, 72062.19226995559, 71791.54876748582]
x0=[P0,T0,Qa0,Qp0,W0] #condicoes iniciais

tetaS=teta_comb
spark=0
P=[p*10**-6 for p in wiebePressure[:205]]
P2=[]
Spark = signal.unit_impulse(len(tk),find_nearest(tk,tetaS))*spark
Pt,Tt=Pi,Ti
for t in range(205,205+len(tj)-1):
    Tt=wiebeTemperature[t]
    Pt=wiebePressure[t]
     
    #calcula x e dt por cinetica usando as temperaturas corretas
    xt,dxdt,concentration,molar_comp = twoStepKinects(next_concentration,[tk[t],tk[t+1]],Tt,Pt)
    print(xt,dxdt)
    
    #resole o sistema usando xt e dx, espera-se encontrar as temperaturas corretas
    x=solve_ivp(motorComb,[tk[t],tk[t+1]],x0,args=(P1[t],xt,dxdt,Spark[t]),method='DOP853').y
    P.append(x[0][-1]*10**-6)
#    
#    Tt=x[1][-1]
#    Pt=x[0][-1]
    

    x0=[x[0][-1],x[1][-1],x[2][-1],x[3][-1],x[4][-1]]
    #concentration = solve_ivp(dc,[tk[t],tk[t+1]],next_concentration,args=(Tt,)).y
#    molar_fractions = np.asarray(next_concentration)*Ru*Tt*10**6/Pt
#    M_m=0
#    for M,ys in zip(mass,molar_fractions):
#        M_m += M*ys
#    mass_fraction=molar_fractions[0]*(M_c/M_m)
#    mass_burned=(Y0-mass_fraction)/Y0
#    dx = (-dc(tk[t+1],next_concentration,Tt)[0]*Ru*Tt/Pt)*(M_c/M_m)*10**6/Y0
   # print(mass_burned,dx)
    
#    C = concentration[0][-1]
#    O2=concentration[1][-1]
#    CO = concentration[2][-1]
#    CO2=concentration[3][-1]
#    H2O = concentration[4][-1]
#    N2 = concentration[5][-1]
#    next_concentration=[C,O2,CO,CO2,H2O,N2]
    next_concentration = concentration
#    lista1.append(next_concentration[0])
#    lista2.append(next_concentration[1])
#    lista3.append(next_concentration[2])
#    lista4.append(next_concentration[3])
#    lista5.append(next_concentration[4])
    
    massFraction.append(xt)


tj = [degrees(j)for j in tj]
m,a=1,2
def wiebed(teta):
    return 1-exp(-a*((teta-teta_combd)/delta_tetad)**(m+1))  
 
wiebeMassFraction12 = [wiebed(te) for te in tj[:-1]] 
m,a=2,5
wiebeMassFraction25 = [wiebed(te) for te in tj[:-1]] 
m,a=4,60
wiebeMassFraction560 = [wiebed(te) for te in tj[:-1]] 
def wiebefit(teta,a,m):
    return 1-np.exp(-a*((teta-teta_combd)/delta_tetad)**(m+1))
formate = curve_fit(wiebefit,tj[:-1],massFraction)

#plt.plot(tj,lista1,label='C8H18')
#plt.plot(tj,lista2,label='O2')
#plt.plot(tj,lista3,label='CO')
#plt.plot(tj,lista4,label='CO2')
#plt.plot(tj,lista5,label='CH2O')
#plt.legend()
#
ax = plt.axes()
ax.set_ylabel('x(θ)',fontsize='x-large')
ax.set_xlabel('θ[°]',fontsize='x-large',loc='right')
plt.plot(tj[:-1],massFraction,color='black',label='Westbrook and Dryer')
plt.plot(tj[:-1],wiebeMassFraction12,'--',color='black',label='Wiebe m=1,a=2')
plt.plot(tj[:-1],wiebeMassFraction25,':',color='black',label='Wiebe m=2,a=5')
plt.plot(tj[:-1],wiebeMassFraction560,'-.',color='black',label='Wiebe m=4,a=60')
plt.legend()
plt.savefig("resultados/massfraction",bbox_inches='tight')
