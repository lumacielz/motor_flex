#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Wed May  4 21:49:08 2022

@author: luiza.maciel
"""
import numpy as np
from scipy.integrate import solve_ivp,odeint
from math import radians,degrees
import matplotlib.pyplot as plt
from math import exp
from scipy.optimize import curve_fit
def find_nearest(array, value):
    idx = (np.abs(array - value)).argmin()
    if array[idx]<=value:
        return idx
    else:
        return idx-1
c=8
h=18
o=0
n=0

Ae=(5.7*10**11) #octano
Ea=15098
me=0.25
ne=1.5

cilindros=4
rotacao=2500
Var=89.25
Ru=8.314


N=rotacao*2*np.pi/60 #rad/s
M_c=(12.0107*c+h*1.008+16*o+28*n)
#
##quantidades estequimetricas de produtos
stoichometricH2O = h/2
stoichometricCO2 = c
OC = (2*stoichometricCO2 + stoichometricH2O - o)/2 #mols de oxigenio
stoichometricN2 = 3.76*OC+n

AC = OC*(32 + 3.76 * 28.16) / M_c  #razao ar combustivel
M_m=(M_c+OC*(32+3.76*28.16))/(1+OC+OC*3.76)  #massa molecular da mistura

#massa de ar admitida
m_air=Var/(0.5*3600*cilindros*(N/(2*np.pi))) #rot por s
#massa de mistura admitida
m_m=m_air/AC+m_air 
#massa de combustivel admitida
m_c=m_air/AC
mols_c = m_c/M_c
#
##fracao massica inicial
Y0 = m_c/m_m
X0 = mols_c/(mols_c+mols_c*OC+3.76*OC*mols_c)
#Rg=Ru/M_m #constante dos gases
##print(X0)
#Y0=m_c/(m_c+32*OC*mols_c)
#X0 = mols_c/(OC*mols_c)
#M_m = (M_c+OC*32)/(1+OC)
teta0d=-164
teta_combd=-4
delta_tetad=37.6
tetafd=146

teta0=radians(teta0d)
tetaf=radians(tetafd)
teta_comb=radians(teta_combd)
delta_teta=radians(delta_tetad)
#
##DADOS PARA WIEBE!
##coefwiebe=input('Coeficientes da equação de Wiebe m , a: ').split(',')
##m=float(coefwiebe[0])
##a=float(coefwiebe[1])
##m,a=1,2
#ef=0.87
#PCI = 44430*10**3
#Qtot=ef*m_c*PCI #kJ
#
#
mass=[M_c,32,28,44,18,28]

def dc (t,Concentrations,T):
    C=Concentrations[0]
    O2=Concentrations[1]
    CO=Concentrations[2]
    CO2=Concentrations[3]
    H2O=Concentrations[4]
    N2=Concentrations[5]
    
    ka=Ae*np.exp(-Ea/T)*np.sign(C)*abs(C)**me*O2**ne
    kbf=10**14.6*np.exp(-20131/T)*CO*H2O**0.5*O2**0.25
    kbr=5*10**8*np.exp(-20131/T)*CO2
    
    dC=-ka/N
    dO2=(-(c/2+h/4)*ka-c*0.5*kbf+c*0.5*kbr)/N
    dCO=(-kbf+ka+kbr)*c/N
    dCO2=(kbf-kbr)*c/N
    dH2O=h/2*ka/N
    dN2=0
    #print(dC,dO2,dCO,dCO2,dH2O)
    return dC,dO2,dCO,dCO2,dH2O,dN2 #gmol;cm3

tk=np.linspace(teta0,tetaf,400)
ti=tk[:find_nearest(tk,teta_comb)]
tj=tk[find_nearest(tk,teta_comb):find_nearest(tk,teta_comb+delta_teta)]
tf=tk[find_nearest(tk,teta_comb+delta_teta):]
time = np.linspace(0,10)
Pi=1425444.9612099533
Ti=723.7213524993258 
wiebeTemperature = [374.9079248949613, 381.26585302702836, 381.43153486106763, 381.6054338865101, 381.7875818062139, 381.9780123698148, 382.1767613804437, 382.3838667018863, 382.5993682661749, 382.8233080816135, 383.05573024123055, 383.29668093165577, 383.5462084424157, 383.80436317564624, 384.07119765622014, 384.34676654227684, 384.63112663616425, 384.9243368957792, 385.2264584463034, 385.5375545923388, 385.85769083042874, 386.1869348619715, 386.52535660651444, 386.87302821543454, 387.2300240859907, 387.59642087575946, 387.9722975174382, 388.35773523402213, 388.752817554349, 389.15763032900924, 389.572261746624, 389.9968023504803, 390.4313450555337, 390.87598516576554, 391.3308203919052, 391.7959508695028, 392.2714791773671, 392.757510356356, 393.25415192852375, 393.7615139166357, 394.27970886402176, 394.80885185480406, 395.3490605344794, 395.9004551308589, 396.4631584753722, 397.0372960247344, 397.62299588297424, 398.2203888238331, 398.82960831352926, 399.45079053388844, 400.08407440585404, 400.72960161336385, 401.3875166276028, 402.0579667316356, 402.74110204541273, 403.4370755511591, 404.1460431191404, 404.8681635338059, 405.6035985203177, 406.3525127714472, 407.11507397485644, 407.89145284074425, 408.6818231298671, 409.48636168191143, 410.3052484442276, 411.1386665009096, 411.9868021022011, 412.84984469422824, 413.7279869490332, 414.62142479488875, 415.53035744688094, 416.4549874377257, 417.3955206487886, 418.3521663412818, 419.3251371875863, 420.31464930267055, 421.32092227554006, 422.3441792006712, 423.38464670936526, 424.4425550009395, 425.51813787368974, 426.61163275553275, 427.7232807342176, 428.8533265870023, 430.00201880969587, 431.16960964487333, 432.3563551091821, 433.56251501953915, 434.7883530180296, 436.03413659533857, 437.3001371124553, 438.5866298204733, 439.89389387814447, 441.22221236696794, 442.5718723034627, 443.94316464829984, 445.3363843118797, 446.75183015602533, 448.1898049912555, 449.650615569205, 451.134572569667, 452.6419905816517, 454.17318807786495, 455.7284873819186, 457.30821462751203, 458.912699708843, 460.5422762213183, 462.1972813916407, 463.8780559962836, 465.5849442671957, 467.3182937835578, 469.07845534831444, 470.86578284801965, 472.68063309454425, 474.52336564688795, 476.3943426114521, 478.29392841869475, 480.22248957421715, 482.1803943818964, 484.16801263672136, 486.18571528464486, 488.23387404661645, 490.31286100370755, 492.42304814002637, 494.5648068398305, 496.7385073349513, 498.94451809839444, 501.18320517958415, 503.4549314764243, 505.7600559389687, 508.09893269904865, 510.47191011986166, 512.8793297589735, 515.321525237777, 517.7988210099321, 520.3115310206888, 522.8599572485108, 525.4443881197758, 528.0650967866359, 530.7223392575078, 533.4163523689384, 536.1473515868204, 538.9155286242575, 541.7210488624314, 544.564048560183, 547.4446318371012, 550.362867414071, 553.3187850945335, 556.3123719686314, 559.3435683220384, 562.4122632300797, 565.5182898174517, 568.6614201630514, 571.8413598291379, 575.057741993541, 578.3101211638829, 581.5979664525786, 584.9206543920334, 588.2774612704721, 591.6675549696625, 595.0899862882002, 598.5436797360278, 602.0274237892743, 605.5398605986026, 609.0794751492488, 612.6445838769981, 616.2333227523318, 619.8436348532687, 623.4732574588008, 627.1197087066032, 630.7802738737835, 634.4519913554832, 638.1316384358703, 641.8157169668438, 645.5004390943235, 649.1817131985612, 652.8551302441655, 656.5159507672303, 660.1590927610808, 663.7791207577772, 667.370236439375, 670.9262711506325, 674.4406807212869, 677.9065430410934, 681.3165588618826, 684.6630563269416, 687.9379997461433, 691.1330031431786, 694.2393490967257, 697.2480133767573, 700.1496958382432, 702.9348579742651, 705.5937674463667, 708.1165498003571, 710.4932474393421, 712.7138857627542, 714.7685461916024, 716.6474455897055, 718.341021362323, 719.8400212748818, 721.1355967933412, 722.2193985150662, 723.0836720459988, 723.7213524993258, 724.1261556550618, 716.2004488138253, 712.2263295610222, 712.2296705475451, 716.1920801513418, 724.0511443921107, 735.7027217625875, 751.0049957298365, 769.7837917003334, 791.8385726410303, 816.9485456288301, 844.8784164900491, 875.3834811979983, 908.2138998300377, 943.1181314049899, 979.8456007632742, 1018.1487202488815, 1057.7844063371485, 1098.5152250258932, 1140.1102800209196, 1182.3459325757424, 1225.0064166933175, 1267.8843912822058, 1310.7814530888381, 1353.5086209641543, 1395.8867928449952, 1437.7471710420875, 1478.9316482843958, 1519.293145773583, 1558.69589467285, 1597.0156535111512, 1634.1398555718056, 1669.967682172139, 1704.4100596502778, 1737.389579704481, 1768.8403444156024, 1798.7077387539077, 1826.9481346205632, 1853.5285314801554, 1878.426139424172, 1901.6279110726791, 1923.1300290959152, 1942.93735634009, 1961.062855599736, 1977.526986004999, 1992.357082821636, 2005.5867271970963, 2017.2551120583046, 2027.406409981189, 2036.0891484274277, 2043.355597285722, 2049.2611731780535, 2053.8638645001975, 2057.2236806678698, 2059.4021285428744, 2060.461718521507, 2060.4655022858965, 2059.4766437517205, 2057.558024297529, 2054.7718829346736, 2051.1794916760387, 2046.8408659891559, 2041.8145098770037, 2036.1571948199173, 2029.9237715354188, 2023.1670132714278, 2015.9374891410282, 2008.2834658347908, 2000.2508359091162, 1991.8830707437514, 1983.2211961886055, 1974.3037888771526, 1965.1669911683055, 1955.8445426880958, 1946.3678264768655, 1936.7659278000199, 1927.0657037524616, 1917.2918618721624, 1907.4670460769564, 1897.6119283464282, 1887.745304685984, 1877.88419402973, 1868.043938861542, 1858.2383064566634, 1848.4795897687068, 1838.7787071058856, 1829.1452998564644, 1819.587827633385, 1810.1136603134798, 1800.7291665434593, 1791.439798377341, 1782.2501717916432, 1773.1641429017552, 1764.1848797700397, 1755.3149297570253, 1746.5562824195745, 1737.910428006398, 1729.378411638869, 1720.9608832993085, 1712.6581437739246, 1704.470186719495, 1696.396737038358, 1688.4372857586147, 1680.5911216226928, 1672.8573595923485, 1665.234966479125, 1657.7227839064963, 1650.3195488074325, 1643.0239116543296, 1635.8344526113506, 1628.7496957913838, 1621.7681217896795, 1614.888178657411, 1608.1082914677145, 1601.4268706166424, 1594.842318991307, 1588.3530381270439, 1581.9574334656345, 1575.6539188173174, 1569.4409201196365, 1563.3168785780288, 1557.2802532643855, 1551.329523242501, 1545.4631892819582, 1539.6797752155312, 1533.9778289889518, 1528.3559234465793, 1522.812656890992, 1517.346653450746, 1511.956563285156, 1506.641062652433, 1501.3988538635622, 1496.228665141329, 1491.1292504014452, 1486.0993889703104, 1481.137885251667, 1476.243568353208, 1471.4152916817848, 1466.6519325150807, 1461.952391556204, 1457.3155924767018, 1452.7404814523293, 1448.2260266954574, 1443.7712179874015, 1439.3750662127634, 1435.0366028981452, 1430.7548797569036, 1426.528968240967, 1422.3579591010273, 1418.240961955589, 1414.1771048696687, 1410.1655339433473, 1406.2054129104727, 1402.2959227477356, 1398.436261294132, 1394.6256428805336, 1390.8632979697193, 1387.1484728063433, 1383.4804290768368, 1379.8584435790317, 1376.2818079012434, 1372.749828110502, 1369.261824449936, 1365.8171310446885, 1362.4150956163799, 1359.0550792057816, 1355.736455903401, 1352.4586125877358, 1349.2209486709648, 1346.022875851833, 1342.8638178754702, 1339.7432102998885, 1336.660500269041, 1333.6151462920539, 1330.6066180285459, 1327.6343960797983, 1324.6979717855763, 1321.7968470263957, 1318.9305340310962, 1316.0985551894953, 1313.300442869955, 1310.535739241813, 1307.803996102319, 1305.1047747081495, 1302.437645611187, 1299.8021884985476, 1297.1979920366334, 1294.624653719127, 1292.0817797188915, 1289.568984743468, 1287.085891894257, 1284.6321325291708, 1282.207346128714, 1279.811180165297, 1277.4432899758538, 1275.1033386375389]
wiebePressure = [67490.0, 71911.27198643053, 72037.1472964978, 72169.22932252969, 72307.5756306319, 72452.24677496245, 72603.30634710682, 72760.8210281027, 72924.86064317898, 73095.49821927944, 73272.8100454443, 73456.87573612714, 73647.7782975285, 73845.60419703268, 74050.44343583853, 74262.38962487761, 74481.54006412244, 74707.99582538797, 74941.86183873692, 75183.24698260595, 75432.2641777725, 75689.03048529151, 75953.66720853433, 76226.29999947138, 76507.05896934353, 76796.07880387883, 77093.49888321343, 77399.46340668737, 77714.1215226918, 78037.62746375287, 78370.14068704762, 78711.82602055345, 79062.85381504685, 79423.40010217203, 79793.64675881556, 80173.7816780292, 80563.99894676004, 80964.49903065407, 81375.48896621517, 81797.182560616, 82229.80059946305, 82673.57106284617, 83128.72935000628, 83595.51851297588, 84074.18949956476, 84565.00140607868, 85068.2217401775, 85584.12669430113, 86113.00143010824, 86655.14037439588, 87210.84752699298, 87780.43678113827, 88364.23225688306, 88962.56864808367, 89575.7915835732, 90204.25800313444, 90848.33654892235, 91508.40797301677, 92184.86556182161, 92878.11557805457, 93588.5777211164, 94316.68560665823, 95062.88726621187, 95827.64566778352, 96611.43925836173, 97414.7625293319, 98238.12660583678, 99082.05986117826, 99947.10855740287, 100833.837513271, 101742.83080087081, 102674.69247219342, 103630.04731705275, 104609.54165380144, 105613.84415435891, 106643.64670514913, 107699.66530561223, 108782.64100604282, 109893.34088658706, 111032.55907931588, 112201.11783538928, 113399.86863941763, 114629.69337322234, 115891.50553130668, 117186.25149045928, 118514.911836003, 119878.50274735234, 121278.0774456348, 122714.72770626405, 124189.58543949312, 125703.82434208943, 127258.6616234405, 128855.35980950127, 130495.22862818213, 132179.62697989517, 133909.9649971461, 135687.70619719743, 137514.36973202066, 139391.53273986597, 141320.83280297878, 143303.9705161401, 145342.71217085503, 147438.8925601881, 149594.4179093869, 151811.2689375745, 154091.50405595847, 156437.2627080922, 158850.7688578645, 161334.33463099707, 163890.3641158774, 166521.3573296323, 169229.91435536917, 172018.739656472, 174890.6465738275, 177848.56201168543, 180895.5313177826, 184034.72336302098, 187269.43582578222, 190603.1006854553, 194039.2899293258, 197581.72147628322, 201234.2653200479, 205000.94989366614, 208885.96865590764, 212893.68689884574, 217028.6487743083, 221295.58453504834, 225699.4179842709, 230245.2741246381, 234938.48699492417, 239784.607679068, 244789.4124684782, 249958.91115388772, 255299.3554179138, 260817.247293555, 266519.3476470635, 272412.6846359789, 278504.5620843529, 284802.56770725106, 291314.5811054241, 298048.7814383602, 305013.65466962114, 312218.0002623431, 319670.9371846579, 327381.90906467836, 335360.68831206486, 343617.3789980138, 352162.4182576117, 361006.5759473094, 370160.9522562318, 379636.97293197375, 389446.3817402759, 399601.22973247693, 410113.8608453482, 420996.8933042713, 432263.19624332, 443925.860893861, 455998.16562788317, 468493.5340734027, 481425.4854470162, 494807.5761751633, 508653.3318003778, 522976.16809464915, 537789.3002302606, 553105.6387916435, 568937.6713530461, 585297.3283005921, 602195.8315466428, 619643.5247771826, 637649.6838931858, 656222.3063647012, 675367.8783181541, 695091.1183355018, 715394.697166633, 736278.9328584732, 757741.4611965736, 779776.8818514007, 802376.381235144, 825527.3338180999, 849212.8845366514, 873411.5159554643, 898096.6050286493, 923235.9756342899, 948791.4545246469, 974718.4399183611, 1000965.4936290453, 1027473.9693280951, 1054177.6912144423, 1081002.6989291802, 1107867.0759072744, 1134680.879385632, 1161346.1908543366, 1187757.3057034279, 1213801.0800367272, 1239357.4509580056, 1264300.1439639053, 1288497.577315245, 1311813.9683667908, 1334110.640840119, 1355247.5250311182, 1375084.8351453836, 1393484.8996399653, 1410314.1119958945, 1425444.9612099533, 1438758.09398766, 1433942.5064727403, 1435343.2571725415, 1443128.012857019, 1457333.550440382, 1477862.15243341, 1504484.5330291125, 1536848.8177354087, 1574494.4747670707, 1616869.7167305266, 1663350.7941547765, 1713261.7488489863, 1765893.4964576052, 1820521.4642367342, 1876421.3418506086, 1932882.7636617718, 1989220.9171448736, 2044786.172891119, 2098971.8770412, 2151220.458105335, 2201027.994347533, 2247947.3769614706, 2291590.1946006506, 2331627.4590314873, 2367789.2898033867, 2399863.676710615, 2427694.4408633504, 2451178.5169131863, 2470262.6792476405, 2484939.8331007315, 2495244.9872286376, 2501251.018142947, 2503064.3271597144, 2500820.481185649, 2494679.9167119903, 2484823.7744821883, 2471449.9201979376, 2454769.194875378, 2435001.9273732407, 2412374.7314568604, 2387117.6006890316, 2359461.3065456664, 2329635.0984657756, 2297864.699041779, 2264370.583161704, 2229366.5265567433, 2193058.4067588695, 2155643.2378342007, 2117308.4193007494, 2078231.179257017, 2038578.1918283666, 1998505.3494902807, 1958157.671561254, 1917669.3310994338, 1877163.7835241158, 1836753.9814613138, 1796542.6615395462, 1756622.690102655, 1717077.4560345495, 1677981.300085342, 1639399.9712347523, 1601391.10171629, 1564004.6933477113, 1527283.6087658077, 1491264.0620444533, 1455976.1039851021, 1421444.0981084167, 1387687.1840476485, 1354719.7256516411, 1322551.7416500666, 1291189.3172204322, 1260634.9952288656, 1230888.1462978774, 1201945.3171878469, 1173800.5572700915, 1146445.7231187327, 1119870.7614624312, 1094063.9709163215, 1069012.243063813, 1044701.2835794078, 1021115.8141805095, 998239.7562705007, 976056.3971902612, 954548.540032483, 933698.6379953104, 913488.9142602496, 893901.4683768036, 874918.3701234605, 856521.7417943883, 838693.8298330986, 821417.0667022027, 804674.1238403182, 788447.9565173385, 772721.8413560428, 757479.4072438749, 742704.6603133949, 728382.0036249019, 714496.2521391324, 701032.6435244984, 687976.8452996333, 675314.9587707855, 663033.52018351, 651119.4994704227, 639560.2969402653, 628343.7382200274, 617458.0677301063, 606891.9409424613, 596634.4156448151, 586674.9424081977, 577003.3544319294, 567609.8569190124, 558485.0161151079, 549619.7481270118, 541005.3076203984, 532633.2764823568, 524495.552521462, 516584.3382665614, 508892.12991535495, 501411.70647493214, 494136.11912833847, 487058.68085449544, 480172.9563226009, 473472.7520769922, 466952.1070238707, 460605.2832274469, 454426.7570197036, 448411.2104252683, 442553.5229004032, 436848.763383411, 431292.18265179644, 425879.205980583, 420605.4260949611, 415466.5964096479, 410458.6245467793, 405577.5661236843, 400819.6188015339, 396181.11658584385, 391658.52436949295, 387248.43270909146, 382947.5528255443, 378752.7118197952, 374660.8480948419, 370669.00697540265, 366774.33651685296, 362974.08349514776, 359265.5895699042, 355646.28761301446, 352113.69819537335, 348665.4262247253, 345299.1577277811, 342012.6567701511, 338803.7625078237, 335670.3863642394, 332610.50932728424, 329622.17936075217, 326703.50892502686, 323852.6726021284, 321067.9048203089, 318347.4976737327, 315689.7988329431, 313093.2095420156, 310556.18269848503, 308077.2210123894, 305654.87524081283, 303287.7424946231, 300974.4646141779, 298713.72661093733, 296504.25517207937, 294344.8172253504, 292234.2185615159, 290171.30251189455, 288154.9486785787, 286184.0717150854, 284257.6201552322, 282374.5752881953, 280533.95007777284, 278734.78812397696, 276976.16266515927, 275257.17561897525, 273576.9566605513, 271934.66233630467, 270329.4752119622, 268760.6030533271, 267227.27803849673, 265728.75600021303, 264264.31569715025, 262833.25811295403, 261434.90578192825, 260068.60214032527, 258733.71090218826, 257429.61545881792, 256155.71830091943, 254911.44046256147, 253696.2209860858, 252509.5164071984, 251350.80025944803]
wiebeMassFraction = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0031938649729299495, 0.0007470372238279621, 3.5544117338304204e-06, 0.0009672222530459074, 0.003633108317256939, 0.007987584079884869, 0.014008440975840752, 0.02166507907046855, 0.030918766105570983, 0.04172296385204899, 0.05402371792182803, 0.06776010647103403, 0.08286474257447607, 0.0992643244775906, 0.11688022744390758, 0.13562913052011139, 0.15542367124145895, 0.1761731211005907, 0.19778407450383695, 0.220161143940389, 0.24320765418894275, 0.2668263285798552, 0.2909199606131134, 0.31539206459683633, 0.34014749940979216, 0.3650930599956018, 0.3901380317561849, 0.4151947036173921, 0.4401788361797633, 0.46501008203122074, 0.4896123559752368, 0.5139141536069418, 0.5378488173405435, 0.5613547496445263, 0.5843755738674346, 0.6068602436285182, 0.6287631022969513, 0.6500438945845772, 0.6706677327252875, 0.69060502010525, 0.7098313355395973, 0.7283272816613375, 0.7460783010966481, 0.76307446424794, 0.779310232593752, 0.7947842014450417, 0.809498826074008, 0.8234601350581945, 0.8366774345636373, 0.8491630071312617, 0.860931808335756, 0.8720011644612248, 0.8823904740886049, 0.8921209162216004, 0.901215167296177, 0.9096971291286814, 0.9175916695643175, 0.9249243772956068, 0.9317213320337957, 0.9380088909386604, 0.9438134919470866, 0.949161474390964, 0.9540789170626058, 0.9585914936728924, 0.9627243454549613, 0.9665019704953899, 0.9699481292258604, 0.9730857653813215, 0.9759369416253039, 0.9785227889587034, 0.980863468964085, 0.9829781478922233, 0.9848849815698811, 0.9866011100962344, 0.9881426612983115, 0.9895247619317049, 0.9907615556399392, 0.9918662267226085, 0.9928510288070911, 0.9937273175697391, 0.9945055867084532, 0.9951955064280843, 0.9958059637618819, 0.9963451041150699, 0.9968203734795388, 0.9972385608306891, 0.997605840277863, 0.9979278125979073, 0.9982095458366772, 0.9984556147153123, 0.9986701386265587, 0.9988568180510806, 0.999018969264457, 0.9991595572423606, 0.9992812267042785, 0.999386331265144, 0.9994769606895353, 0.9995549662648331, 0.9996219843281098, 0.9996794579967858, 0.999728657165467, 0.9997706968411244, 0.9998065538961544, 0.9998370823241092, 0.9998630270862772, 0.9998850366390407, 0.9999036742322986, 0.9999194280684022, 0.9999327204092368, 0.9999439157164544, 0.9999533279066045, 0.9999612267991593, 0.9999678438313272, 0.9999733771092048, 0.9999779958603384, 0.9999818443482328, 0.9999850453048291, 0.9999877029325492, 0.9999899055231879, 0.9999917277368056, 0.999993232579821, 0.9999944731177798, 0.999995493954769, 0.9999963325081853, 0.9999970201045363, 0.9999975829191683, 0.999998042780253, 0.9999984178550374, 0.9999987232342435, 0.9999989714285893, 0.9999991727896855, 0.9999993358660181, 0.9999994677033496, 0.9999995740976528, 0.9999996598076031, 0.9999997287327016, 0.9999997840622606, 0.9999998283997452, 0.9999998638663229, 0.9999998921869104, 0.9999999147615237, 0.9999999327243143, 0.9999999469923125, 0.9999999583055882, 0.9999999672602684, 0.9999999743356276, 0.9999999799162665, 0.999999984310232, 0.9999999877637916, 0.9999999904734539, 0.9999999925957282, 0.9999999942550335, 0.9999999955500931, 0.9999999965590955, 0.9999999973438501, 0.9999999979531276, 0.9999999984253383, 0.9999999987906777, 0.9999999990728391, 0.9999999992903791, 0.9999999994578044, 0.9999999995864349, 0.9999999996850875, 0.9999999997606165, 0.999999999818341, 0.9999999998623812, 0.9999999998959225, 0.9999999999214232, 0.999999999940777, 0.9999999999554401, 0.9999999999665299, 0.9999999999749027, 0.999999999981213, 0.9999999999859608, 0.9999999999895266, 0.9999999999922, 0.999999999994201, 0.999999999995696, 0.999999999996811, 0.9999999999976412, 0.9999999999982583, 0.999999999998716, 0.9999999999990552, 0.9999999999993059, 0.999999999999491, 0.9999999999996273, 0.9999999999997277, 0.9999999999998013, 0.9999999999998552, 0.9999999999998948, 0.9999999999999236, 0.9999999999999446, 0.9999999999999599, 0.999999999999971, 0.9999999999999791]
c0fuel=Pi*X0/(Ru*Ti) #[Pa][gmol/gmol]/[J/molK][K] = [gmol/m3]
c0O2=Pi*X0*OC/(Ru*Ti)
c0N2=c0O2*3.76
lista1,lista2,lista3,lista4,lista5=[c0fuel*10**-6],[c0O2*10**-6],[0],[0],[0]
massFraction=[]
#next_concentration=[1,12.5,0,0,0,0]
next_concentration=[c0fuel*10**-6,c0O2*10**-6,0,0,0,c0N2*10**-6]
for t in range(205,205+len(tj)-1):
    Tt=wiebeTemperature[t]
    Pt=wiebePressure[t]
    concentration = solve_ivp(dc,[tk[t],tk[t+1]],next_concentration,args=(Tt,)).y
    molar_fractions = np.asarray(next_concentration)*Ru*Tt*10**6/Pt
    M_m=0
    for M,ys in zip(mass,molar_fractions):
        M_m += M*ys
    mass_fraction=molar_fractions[0]*(M_c/M_m)
    mass_burned=(Y0-mass_fraction)/Y0
    dx = (-dc(tk[t+1],next_concentration,Tt)[0]*Ru*Tt/Pt)*(M_c/M_m)*10**6/Y0
    print(mass_burned,dx)
    C = concentration[0][-1]
    O2=concentration[1][-1]
    CO = concentration[2][-1]
    CO2=concentration[3][-1]
    H2O = concentration[4][-1]
    N2 = concentration[5][-1]
    next_concentration=[C,O2,CO,CO2,H2O,N2]
    lista1.append(next_concentration[0])
    lista2.append(next_concentration[1])
    lista3.append(next_concentration[2])
    lista4.append(next_concentration[3])
    lista5.append(next_concentration[4])
    massFraction.append(mass_burned)


tj = [degrees(j)for j in tj]
m,a=1,2
def wiebe(teta):
    return 1-exp(-a*((teta-teta_combd)/delta_tetad)**(m+1))  
 
wiebeMassFraction12 = [wiebe(te) for te in tj[:-1]] 
m,a=2,5
wiebeMassFraction25 = [wiebe(te) for te in tj[:-1]] 
m,a=4,60
wiebeMassFraction560 = [wiebe(te) for te in tj[:-1]] 
def wiebefit(teta,a,m):
    return 1-np.exp(-a*((teta-teta_combd)/delta_tetad)**(m+1))
formate = curve_fit(wiebefit,tj[:-1],massFraction)

#plt.plot(tj,lista1,label='C8H18')
#plt.plot(tj,lista2,label='O2')
#plt.plot(tj,lista3,label='CO')
#plt.plot(tj,lista4,label='CO2')
#plt.plot(tj,lista5,label='CH2O')
#plt.legend()
#
ax = plt.axes()
ax.set_ylabel('x(θ)',fontsize='x-large')
ax.set_xlabel('θ[°]',fontsize='x-large',loc='right')
plt.plot(tj[:-1],massFraction,color='black',label='Westbrook and Dryer')
plt.plot(tj[:-1],wiebeMassFraction12,'--',color='black',label='Wiebe m=1,a=2')
plt.plot(tj[:-1],wiebeMassFraction25,':',color='black',label='Wiebe m=2,a=5')
plt.plot(tj[:-1],wiebeMassFraction560,'-.',color='black',label='Wiebe m=4,a=60')
plt.legend()
plt.savefig("resultados/massfraction",bbox_inches='tight')
